---
apiVersion: secret-agent.secrets.forgerock.io/v1alpha1
kind: SecretAgentConfiguration
metadata:
  name: forgerock-sac
spec:
  appConfig:
    createKubernetesObjects: true
    secretsManager: none
  secrets:
  # platform-ca secret: a root certificate for signing keys ------------------------------------
  - name: platform-ca
    keys:
      # When a type of `ca` is set, the names of the keys will be `{name}.pem` and
      # `{name}-private.pem`.
      - name: ca
        type: ca
        spec:
          # These are the values for the certificate's distinguished name.
          # They must be supported by https://golang.org/pkg/crypto/x509/pkix/#Name.
          # Note _SerialNumber_, r_Names_, and _ExtraNames_  aren't supported.
          # Serial Number is generated by the operator.
          distinguishedName:
            commonName: "Deployment key"
            organization:
              - "ForgeRock.com"
  # IDM secrets ---------------------------------------------------------------------------------
  # idm-env-secrets secret
  - name: idm-env-secrets 
    keys:
# generated 
#    - name: OPENIDM_KEYSTORE_PASSWORD
#      type: password
#      spec:
#        length: 24

# hardcoded
    - name: OPENIDM_KEYSTORE_PASSWORD
      type: literal
      spec:
        value: "#OPENIDM_KEYSTORE_PASSWORD#"
        isBase64: false

  # idm secret
  - name: idm
    keys:
    - name: truststore
      type: truststore
      spec:
        truststoreImportPaths: ["platform-ca/ca"]
    - name: keystore.jceks
      type: keytool
      spec:
        storeType: jceks
        storePassPath: idm-env-secrets/OPENIDM_KEYSTORE_PASSWORD
        keyPassPath: idm-env-secrets/OPENIDM_KEYSTORE_PASSWORD
        keytoolAliases:
        - name: openidm-sym-default
          cmd: genseckey
          args: ["-keyalg", "aes", "-keysize", "128"]
        - name: openidm-jwtsessionhmac-key
          cmd: genseckey
          args: ["-keyalg", "HmacSHA256", "-keysize", "256"]
        - name: openidm-selfservice-key
          cmd: genseckey
          args: ["-keyalg", "aes", "-keysize", "128"]
        - name: server-cert
          cmd: genkeypair
          args: ["-keyalg", "RSA", "-keysize", "2048", "-sigalg", "SHA256WITHRSA", "-validity", "3650", "-dname", "CN=server-cert,O=ForgeRock,L=Bristol,ST=Bristol,C=UK"]
        - name: selfservice
          cmd: genkeypair
          args: ["-keyalg", "RSA", "-keysize", "2048", "-sigalg", "SHA256WITHRSA", "-validity", "3650", "-dname", "CN=selfservice,O=ForgeRock,L=Bristol,ST=Bristol,C=UK"]
        - name: openidm-localhost
          cmd: genkeypair
          args: ["-keyalg", "RSA", "-keysize", "2048", "-sigalg", "SHA256WITHRSA", "-validity", "3650", "-dname", "CN=openidm-localhost,O=ForgeRock,L=Bristol,ST=Bristol,C=UK"]
