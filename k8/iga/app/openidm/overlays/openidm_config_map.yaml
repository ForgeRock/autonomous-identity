---
kind: ConfigMap
metadata:
    name: idm-conf-audit
apiVersion: v1
data:
    audit.json: |
        {
            "auditServiceConfig" : {
                "handlerForQueries" : "json",
                "availableAuditEventHandlers" : [
                    "org.forgerock.audit.handlers.csv.CsvAuditEventHandler",
                    "org.forgerock.audit.handlers.elasticsearch.ElasticsearchAuditEventHandler",
                    "org.forgerock.audit.handlers.jms.JmsAuditEventHandler",
                    "org.forgerock.audit.handlers.json.JsonAuditEventHandler",
                    "org.forgerock.audit.handlers.json.stdout.JsonStdoutAuditEventHandler",
                    "org.forgerock.openidm.audit.impl.RepositoryAuditEventHandler",
                    "org.forgerock.openidm.audit.impl.RouterAuditEventHandler",
                    "org.forgerock.audit.handlers.splunk.SplunkAuditEventHandler",
                    "org.forgerock.audit.handlers.syslog.SyslogAuditEventHandler",
                    "org.forgerock.audit.handlers.jas.JasAuditEventHandler"
                ],
                "filterPolicies" : {
                    "field" : {
                        "excludeIf" : [ ],
                        "includeIf" : [
                                "/config/before",
                                "/config/after",
                                "/activity/before",
                                "/activity/after"
                        ]
                    }
                },
                "caseInsensitiveFields" : [
                    "/access/http/request/headers",
                    "/access/http/response/headers"
                ]
            },
            "eventHandlers" : [
            {
                    "class" : "org.forgerock.audit.handlers.jas.JasAuditEventHandler",
                    "config" : {
                        "name" : "jas",
                        "tenantId" : "#JAS_TENANT_ID#",
                        "jasUrl" : "https://jas:10081",
                        "nameSpace" : "openidm",
                        "parserClass" : "org.forgerock.audit.handlers.jas.OpenIdmEventParser",
                        "topicMetaFields" : {
                                "activity": ["transactionId", "userId", "trackingId", "runAs", "operation", "changedFields", "message", "eventName", "status", "passwordChanged", "context"],
                                "config": ["transactionId", "userId", "trackingId", "runAs", "operation", "changedFields"]
                        },
                        "topics" : [
                                "activity",
                                "config"
                        ],
                        "disableSslCertificateVerification": true,
                        "enabled": true
                    }
                },
                {
                    "class" : "org.forgerock.audit.handlers.json.JsonAuditEventHandler",
                    "config" : {
                        "name" : "json",
                        "logDirectory" : "&{idm.data.dir}/audit",
                        "buffering" : {
                            "maxSize" : 100000,
                            "writeInterval" : "100 millis"
                        },
                        "topics" : [
                            "access",
                            "activity",
                            "sync",
                            "authentication",
                            "config"
                        ]
                    }
                },
                {
                    "class" : "org.forgerock.audit.handlers.json.stdout.JsonStdoutAuditEventHandler",
                    "config" : {
                        "name" : "json-stdout",
                        "topics" : [
                            "activity",
                            "sync",
                            "authentication",
                            "config"
                        ]
                    }
                },
                {
                    "class": "org.forgerock.openidm.audit.impl.RepositoryAuditEventHandler",
                    "config": {
                        "name": "repo",
                        "enabled": false,
                        "topics": [
                            "access",
                            "activity",
                            "sync",
                            "authentication",
                            "config"
                        ]
                    }
                }
            ],
            "eventTopics" : {
                "config" : {
                    "filter" : {
                        "actions" : [
                            "create",
                            "update",
                            "delete",
                            "patch",
                            "action"
                        ]
                    }
                },
                "activity" : {
                    "filter" : {
                        "actions" : [
                            "create",
                            "update",
                            "delete",
                            "patch",
                            "action"
                        ]
                    },
                    "watchedFields" : [ ],
                    "passwordFields" : [
                        "password"
                    ]
                }
            },
            "exceptionFormatter" : {
                "type" : "text/javascript",
                "file" : "bin/defaults/script/audit/stacktraceFormatter.js"
            }
        }

---
kind: ConfigMap
metadata:
    name: idm-conf-metrics
apiVersion: v1
data:
    metrics.json: |
        {
            "enabled" : true
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-secrets-json
data:
    secrets.json: |
        {
        "stores": [
        {
          "name": "mainKeyStore",
          "class": "org.forgerock.openidm.secrets.config.FileBasedStore",
          "config": {
            "file": "&{openidm.keystore.location|/var/run/secrets/idm/keystore.jceks}",
            "storetype": "&{openidm.keystore.type|JCEKS}",
            "providerName": "&{openidm.keystore.provider|SunJCE}",
            "storePassword": "&{openidm.keystore.password|changeit}",
            "mappings": [
              {
                "secretId" : "idm.default",
                "types": [ "ENCRYPT", "DECRYPT" ],
                "aliases": [ "&{openidm.config.crypto.alias|openidm-sym-default}" ]
              },
              {
                "secretId" : "idm.config.encryption",
                "types": [ "ENCRYPT", "DECRYPT" ],
                "aliases": [ "&{openidm.config.crypto.alias|openidm-sym-default}" ]
              },
              {
                "secretId" : "idm.password.encryption",
                "types": [ "ENCRYPT", "DECRYPT" ],
                "aliases": [ "&{openidm.config.crypto.alias|openidm-sym-default}" ]
              },
              {
                "secretId" : "idm.jwt.session.module.encryption",
                "types": [ "ENCRYPT", "DECRYPT" ],
                "aliases": [ "&{openidm.https.keystore.cert.alias|openidm-localhost}" ]
              },
              {
                "secretId" : "idm.jwt.session.module.signing",
                "types": [ "SIGN", "VERIFY" ],
                "aliases": [ "&{openidm.config.crypto.jwtsession.hmackey.alias|openidm-jwtsessionhmac-key}" ]
              },
              {
                "secretId" : "idm.selfservice.encryption",
                "types": [ "ENCRYPT", "DECRYPT" ],
                "aliases": [ "selfservice" ]
              },
              {
                "secretId" : "idm.selfservice.signing",
                "types": [ "SIGN", "VERIFY" ],
                "aliases": [ "&{openidm.config.crypto.selfservice.sharedkey.alias|openidm-selfservice-key}" ]
              }
            ]
          }
        },
        {
          "name": "mainTrustStore",
          "class": "org.forgerock.openidm.secrets.config.FileBasedStore",
          "config": {
            "file": "&{openidm.truststore.location|/var/run/secrets/idm/truststore}",
            "storetype": "&{openidm.truststore.type|JKS}",
            "providerName": "&{openidm.truststore.provider|SUN}",
            "storePassword": "&{openidm.truststore.password|changeit}",
            "mappings": [
            ]
          }
        }
        ],
        "populateDefaults": true
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-identity-providers-json
data:
    identityProviders.json: |
        {
        "providers" : [
            {
                "provider" : "microsoft",
                "authorizationEndpoint" : "https://login.microsoftonline.com/common/oauth2/v2.0/authorize",
                "tokenEndpoint" : "https://login.microsoftonline.com/common/oauth2/v2.0/token",
                "userInfoEndpoint" : "https://graph.microsoft.com/v1.0/me",
                "clientId" : "",
                "clientSecret" : "",
                "scope" : [
                    "User.Read"
                ],
                "authenticationIdKey" : "id",
                "basicAuth" : false,
                "uiConfig": {
                    "iconBackground": "#0078d7",
                    "iconClass": "fa-windows",
                    "iconFontColor": "white",
                    "buttonImage" : "images/microsoft-logo.png",
                    "buttonClass": "",
                    "buttonDisplayName" : "Microsoft",
                    "buttonCustomStyle" : "background-color: #fff; border-color: #8b8b8b; color: #8b8b8b;",
                    "buttonCustomStyleHover" : "background-color: #fff; border-color: #8b8b8b; color: #8b8b8b;"
                },
                "schema" : {
                    "id" : "urn:jsonschema:org:forgerock:openidm:identityProviders:api:Microsoft",
                    "title": "Microsoft",
                    "viewable" : true,
                    "type" : "object",
                    "$schema" : "http://json-schema.org/draft-03/schema",
                    "properties" : {
                        "id" : {
                            "description" : "ID",
                            "title" : "ID",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : false
                        },
                        "displayName" : {
                            "description" : "Name",
                            "title" : "Name",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : true
                        },
                        "givenName" : {
                            "description" : "First Name",
                            "title" : "First Name",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : true
                        },
                        "surname" : {
                            "description" : "Last Name",
                            "title" : "Last Name",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : true
                        },
                        "userPrincipalName": {
                            "description" : "Email Address",
                            "title": "Email Address",
                            "viewable": true,
                            "type": "string",
                            "searchable": true
                        }
                    },
                    "order" : [
                        "id",
                        "displayName",
                        "userPrincipalName",
                        "givenName",
                        "surname"
                    ],
                    "required" : [ ]
                },
                "propertyMap": [
                    {
                        "source" : "id",
                        "target" : "id"
                    },
                    {
                        "source" : "displayName",
                        "target" : "displayName"
                    },
                    {
                        "source" : "givenName",
                        "target" : "givenName"
                    },
                    {
                        "source" : "surname",
                        "target" : "familyName"
                    },
                    {
                        "source" : "userPrincipalName",
                        "target" : "email"
                    },
                    {
                        "source" : "userPrincipalName",
                        "target" : "username"
                    }
                ],
                "redirectUri" : "https://localhost:8443/",
                "configClass" : "org.forgerock.oauth.clients.oauth2.OAuth2ClientConfiguration"
            }            
          ]
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-identityprovider-microsoft-json
data:
    identityProvider-microsoft.json: |
        {
         "provider" : "microsoft",
         "authorizationEndpoint" : "#AUTHORIZATION_ENDPOINT#",
         "tokenEndpoint" : "#TOKEN_ENDPOINT#",
         "userInfoEndpoint" : "#USER_INFO_ENDPOINT#",
         "clientId" : "#CLIENT_ID#",
         "clientSecret" :"#CLIENT_SECRET#",
         "scope" : #SCOPE#,
         "authenticationIdKey" : "id",
         "basicAuth" : false,
         "uiConfig" : {
             "iconBackground" : "#0078d7",
             "iconClass" : "fa-windows",
             "iconFontColor" : "white",
             "buttonImage" : "images/microsoft-logo.png",
             "buttonDisplayName" : "Microsoft",
             "buttonCustomStyle" : "background-color: #fff; border-color: #8b8b8b; color: #8b8b8b;",
             "buttonCustomStyleHover" : "background-color: #fff; border-color: #8b8b8b; color: #8b8b8b;"
         },
         "schema" : {
             "id" : "urn:jsonschema:org:forgerock:openidm:identityProviders:api:Microsoft",
             "title" : "Microsoft",
             "viewable" : true,
             "type" : "object",
             "$schema" : "http://json-schema.org/draft-03/schema",
             "properties" : {
                 "id" : {
                     "description" : "ID",
                     "title" : "ID",
                     "viewable" : true,
                     "type" : "string",
                     "searchable" : false
                 },
                 "displayName" : {
                     "description" : "Name",
                     "title" : "Name",
                     "viewable" : true,
                     "type" : "string",
                     "searchable" : true
                 },
                 "givenName" : {
                     "description" : "First Name",
                     "title" : "First Name",
                     "viewable" : true,
                     "type" : "string",
                     "searchable" : true
                 },
                 "surname" : {
                     "description" : "Last Name",
                     "title" : "Last Name",
                     "viewable" : true,
                     "type" : "string",
                     "searchable" : true
                 },
                 "userPrincipalName" : {
                     "description" : "Email Address",
                     "title" : "Email Address",
                     "viewable" : true,
                     "type" : "string",
                     "searchable" : true
                 }
             },
             "order" : [
                 "id",
                 "displayName",
                 "userPrincipalName",
                 "givenName",
                 "surname"
             ],
             "required" : [ ]
         },
         "propertyMap" : [
             {
                 "source" : "id",
                 "target" : "id"
             },
             {
                 "source" : "displayName",
                 "target" : "displayName"
             },
             {
                 "source" : "givenName",
                 "target" : "givenName"
             },
             {
                 "source" : "surname",
                 "target" : "familyName"
             },
             {
                 "source" : "userPrincipalName",
                 "target" : "email"
             },
             {
                 "source" : "userPrincipalName",
                 "target" : "username"
             }
         ],
         "redirectUri" : "https://platform-ui.#DOMAIN_NAME#/",
         "configClass" : "org.forgerock.oauth.clients.oauth2.OAuth2ClientConfiguration",
         "enabled" : true
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-selfservice-registration-json
data:
    selfservice-registration.json: |
        {
         "allInOneRegistration" : true,
         "stageConfigs" : [
             {
                 "name" : "parameters",
                 "parameterNames" : [
                     "returnParams"
                 ]
             },
             {
                 "name" : "idmUserDetails",
                 "identityEmailField" : "mail",
                 "socialRegistrationEnabled" : true,
                 "registrationProperties" : [
                     "userName",
                     "givenName",
                     "sn",
                     "mail"
                 ],
                 "identityServiceUrl" : "managed/user",
                 "registrationPreferences" : [
                     "marketing",
                     "updates"
                 ]
             },
             {
                 "name" : "selfRegistration",
                 "identityServiceUrl" : "managed/user"
             },
             {
                 "name" : "localAutoLogin",
                 "identityUsernameField" : "userName",
                 "identityPasswordField" : "password",
                 "successUrl" : ""
             }
         ],
         "snapshotToken" : {
             "type" : "jwt",
             "jweAlgorithm" : "RSAES_PKCS1_V1_5",
             "encryptionMethod" : "A128CBC_HS256",
             "jwsAlgorithm" : "HS256",
             "tokenExpiry" : 300
         },
         "storage" : "stateless"
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-ui-configuration-json
data:
    ui-configuration.json: |
        {
        "configuration" : {
            "selfRegistration" : true,
            "passwordReset" : false,
            "forgotUsername" : false,
            "lang" : "en",
            "passwordResetLink" : "",
            "roles" : {
                "internal/role/openidm-authorized" : "ui-user",
                "internal/role/openidm-admin" : "ui-admin"
            },
            "notificationTypes" : {
                "info" : {
                    "name" : "common.notification.types.info",
                    "iconPath" : "images/notifications/info.png"
                },
                "warning" : {
                    "name" : "common.notification.types.warning",
                    "iconPath" : "images/notifications/warning.png"
                },
                "error" : {
                    "name" : "common.notification.types.error",
                    "iconPath" : "images/notifications/error.png"
                }
            },
            "defaultNotificationType" : "info",
            "kbaDefinitionEnabled" : false,
            "kbaEnabled" : false
        }
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-selfservice-socialuserclaim-json
data:
    selfservice-socialUserClaim.json: |
        {
        "stageConfigs" : [
            {
                "name" : "parameters",
                "parameterNames" : [
                    "returnParams"
                ]
            },
            {
                "name" : "socialUserClaim",
                "identityServiceUrl" : "managed/user",
                "claimQueryFilter" : "/mail eq \"{{mail}}\""
            },
            {
                "name" : "localAutoLogin",
                "identityUsernameField" : "userName",
                "identityPasswordField" : "password",
                "successUrl" : ""
            }
        ],
        "snapshotToken" : {
            "type" : "jwt",
            "jweAlgorithm" : "RSAES_PKCS1_V1_5",
            "encryptionMethod" : "A128CBC_HS256",
            "jwsAlgorithm" : "HS256",
            "tokenExpiry" : 300
        },
        "storage" : "stateless"
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-managed-json
data:
    managed.json: |
        {
        "objects" : [
            {
                "name" : "user",
                "postDelete" : {
                    "source" : "require('postDelete-idp-cleanup').removeConnectedIdpData(oldObject, resourceName, request);require('postDelete-notification-cleanup').removeConnectedNotificationData(oldObject, resourceName, request);",
                    "type" : "text/javascript"
                },
                "onUpdate" : {
                    "source" : "require('onUpdateUser').preserveLastSync(object, oldObject, request);",
                    "type" : "text/javascript"
                },
                "notifications" : {
                    "property" : "_notifications"
                },
                "meta" : {
                    "trackedProperties" : [
                        "createDate",
                        "lastChanged"
                    ],
                    "resourceCollection" : "internal/usermeta",
                    "property" : "_meta"
                },
                "schema" : {
                    "properties" : {
                        "lastSync" : {
                            "viewable" : false,
                            "description" : "Last Sync timestamp",
                            "searchable" : false,
                            "title" : "Last Sync timestamp",
                            "usageDescription" : "",
                            "required" : [ ],
                            "order" : [
                                "effectiveAssignments",
                                "timestamp"
                            ],
                            "isPersonal" : false,
                            "scope" : "private",
                            "type" : "object",
                            "properties" : {
                                "timestamp" : {
                                    "type" : "string",
                                    "description" : "Timestamp"
                                },
                                "effectiveAssignments" : {
                                    "items" : {
                                        "type" : "object",
                                        "title" : "Effective Assignments Items"
                                    },
                                    "type" : "array",
                                    "description" : "Effective Assignments",
                                    "title" : "Effective Assignments"
                                }
                            }
                        },
                        "managedApplications" : {
                            "viewable" : true,
                            "description" : "",
                            "searchable" : false,
                            "title" : "Managed Applications",
                            "minLength" : null,
                            "items" : {
                                "reversePropertyName" : "owner",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/Application",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "notify" : true,
                                        "label" : "Application"
                                    }
                                ],
                                "type" : "relationship",
                                "validate" : false,
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "policies" : [ ],
                            "returnByDefault" : false,
                            "pattern" : "",
                            "notifySelf" : false,
                            "type" : "array"
                        },
                        "memberOfOrg" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : "Organizations to which I Belong",
                            "items" : {
                                "reversePropertyName" : "members",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/organization",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "notify" : false,
                                        "label" : "Organization"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : true,
                                "type" : "relationship",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "policies" : [ ],
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "manager" : {
                            "viewable" : true,
                            "description" : "Manager",
                            "searchable" : false,
                            "title" : "Manager",
                            "usageDescription" : "",
                            "reversePropertyName" : "reports",
                            "isPersonal" : false,
                            "resourceCollection" : [
                                {
                                    "path" : "managed/user",
                                    "query" : {
                                        "queryFilter" : "true",
                                        "fields" : [
                                            "userName",
                                            "givenName",
                                            "sn"
                                        ]
                                    },
                                    "label" : "User"
                                }
                            ],
                            "userEditable" : false,
                            "validate" : true,
                            "type" : "relationship",
                            "properties" : {
                                "_ref" : {
                                    "type" : "string",
                                    "description" : "References a relationship from a managed object"
                                },
                                "_refProperties" : {
                                    "properties" : {
                                        "_id" : {
                                            "type" : "string",
                                            "description" : "_refProperties object ID"
                                        }
                                    },
                                    "type" : "object",
                                    "description" : "Supports metadata within the relationship",
                                    "title" : "Manager _refProperties"
                                }
                            },
                            "reverseRelationship" : true
                        },
                        "accounts" : {
                            "viewable" : true,
                            "description" : "",
                            "searchable" : false,
                            "title" : "Accounts",
                            "minLength" : null,
                            "items" : {
                                "reversePropertyName" : "user",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/account",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "application"
                                            ]
                                        },
                                        "notify" : false,
                                        "label" : "Account"
                                    }
                                ],
                                "type" : "relationship",
                                "validate" : true,
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "policies" : [ ],
                            "returnByDefault" : false,
                            "pattern" : "",
                            "notifySelf" : false,
                            "type" : "array"
                        },
                        "reports" : {
                            "viewable" : true,
                            "description" : "Direct Reports",
                            "title" : "Direct Reports",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "items" : {
                                "title" : "Direct Reports Items",
                                "reversePropertyName" : "manager",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string",
                                        "description" : "References a relationship from a managed object"
                                    },
                                    "_refProperties" : {
                                        "properties" : {
                                            "_id" : {
                                                "type" : "string",
                                                "description" : "_refProperties object ID"
                                            }
                                        },
                                        "type" : "object",
                                        "description" : "Supports metadata within the relationship",
                                        "title" : "Direct Reports Items _refProperties"
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/user",
                                        "query" : {
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "userName",
                                                "givenName",
                                                "sn"
                                            ]
                                        },
                                        "label" : "User"
                                    }
                                ],
                                "validate" : true,
                                "type" : "relationship",
                                "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:User:reports:items",
                                "reverseRelationship" : true
                            },
                            "type" : "array"
                        },
                        "ownerOfOrg" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : "Organizations I Own",
                            "items" : {
                                "reversePropertyName" : "owners",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/organization",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "notify" : true,
                                        "label" : "Organization"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : false,
                                "type" : "relationship",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "policies" : [ ],
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "effectiveRoles" : {
                            "viewable" : false,
                            "description" : "Effective Roles",
                            "title" : "Effective Roles",
                            "isVirtual" : true,
                            "usageDescription" : "",
                            "queryConfig" : {
                                "referencedRelationshipFields" : [
                                    "roles"
                                ]
                            },
                            "isPersonal" : false,
                            "returnByDefault" : true,
                            "items" : {
                                "type" : "object",
                                "title" : "Effective Roles Items"
                            },
                            "type" : "array"
                        },
                        "serviceAccounts" : {
                            "viewable" : true,
                            "description" : "",
                            "searchable" : false,
                            "title" : "Serviceaccounts",
                            "items" : {
                                "reversePropertyName" : "actors",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/account",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [ ]
                                        },
                                        "notify" : false,
                                        "label" : "Account"
                                    }
                                ],
                                "type" : "relationship",
                                "validate" : false,
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "notifySelf" : false,
                            "type" : "array"
                        },
                        "city" : {
                            "viewable" : true,
                            "description" : "City",
                            "title" : "City",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "preferences" : {
                            "viewable" : true,
                            "description" : "Preferences",
                            "searchable" : false,
                            "title" : "Preferences",
                            "usageDescription" : "",
                            "required" : [ ],
                            "order" : [
                                "updates",
                                "marketing"
                            ],
                            "isPersonal" : false,
                            "userEditable" : true,
                            "type" : "object",
                            "properties" : {
                                "marketing" : {
                                    "type" : "boolean",
                                    "description" : "Send me special offers and services"
                                },
                                "updates" : {
                                    "type" : "boolean",
                                    "description" : "Send me news and updates"
                                }
                            }
                        },
                        "stateProvince" : {
                            "viewable" : true,
                            "description" : "State/Province",
                            "title" : "State/Province",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "effectiveAssignments" : {
                            "viewable" : false,
                            "description" : "Effective Assignments",
                            "title" : "Effective Assignments",
                            "isVirtual" : true,
                            "usageDescription" : "",
                            "queryConfig" : {
                                "referencedObjectFields" : [
                                    "*"
                                ],
                                "referencedRelationshipFields" : [
                                    "roles",
                                    "assignments"
                                ]
                            },
                            "isPersonal" : false,
                            "returnByDefault" : true,
                            "items" : {
                                "type" : "object",
                                "title" : "Effective Assignments Items"
                            },
                            "type" : "array"
                        },
                        "postalCode" : {
                            "viewable" : true,
                            "description" : "Postal Code",
                            "title" : "Postal Code",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "mail" : {
                            "viewable" : true,
                            "description" : "Email Address",
                            "searchable" : true,
                            "title" : "Email Address",
                            "usageDescription" : "",
                            "isPersonal" : true,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "policyId" : "valid-email-address-format"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "postalAddress" : {
                            "viewable" : true,
                            "description" : "Address 1",
                            "title" : "Address 1",
                            "usageDescription" : "",
                            "isPersonal" : true,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "kbaInfo" : {
                            "viewable" : false,
                            "description" : "KBA Info",
                            "usageDescription" : "",
                            "isPersonal" : true,
                            "userEditable" : true,
                            "items" : {
                                "required" : [ ],
                                "order" : [
                                    "answer",
                                    "customQuestion",
                                    "questionId"
                                ],
                                "type" : "object",
                                "properties" : {
                                    "answer" : {
                                        "type" : "string",
                                        "description" : "Answer"
                                    },
                                    "questionId" : {
                                        "type" : "string",
                                        "description" : "Question ID"
                                    },
                                    "customQuestion" : {
                                        "type" : "string",
                                        "description" : "Custom question"
                                    }
                                },
                                "title" : "KBA Info Items"
                            },
                            "type" : "array"
                        },
                        "userName" : {
                            "viewable" : true,
                            "description" : "Username",
                            "searchable" : true,
                            "title" : "Username",
                            "usageDescription" : "",
                            "isPersonal" : true,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "policyId" : "valid-username"
                                },
                                {
                                    "params" : {
                                        "forbiddenChars" : [
                                            "/"
                                        ]
                                    },
                                    "policyId" : "cannot-contain-characters"
                                },
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "description" : {
                            "viewable" : true,
                            "description" : "Description",
                            "searchable" : true,
                            "title" : "Description",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "password" : {
                            "viewable" : false,
                            "description" : "Password",
                            "searchable" : false,
                            "title" : "Password",
                            "encryption" : {
                                "purpose" : "idm.password.encryption"
                            },
                            "isPersonal" : false,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 8
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "numCaps" : 1
                                    },
                                    "policyId" : "at-least-X-capitals"
                                },
                                {
                                    "params" : {
                                        "numNums" : 1
                                    },
                                    "policyId" : "at-least-X-numbers"
                                },
                                {
                                    "params" : {
                                        "disallowedFields" : [
                                            "userName",
                                            "givenName",
                                            "sn"
                                        ]
                                    },
                                    "policyId" : "cannot-contain-others"
                                }
                            ],
                            "isProtected" : true,
                            "scope" : "private",
                            "type" : "string",
                            "usageDescription" : ""
                        },
                        "consentedMappings" : {
                            "viewable" : false,
                            "description" : "Consented Mappings",
                            "searchable" : false,
                            "title" : "Consented Mappings",
                            "isVirtual" : false,
                            "usageDescription" : "",
                            "returnByDefault" : false,
                            "isPersonal" : false,
                            "userEditable" : true,
                            "items" : {
                                "required" : [
                                    "mapping",
                                    "consentDate"
                                ],
                                "order" : [
                                    "mapping",
                                    "consentDate"
                                ],
                                "type" : "object",
                                "properties" : {
                                    "consentDate" : {
                                        "viewable" : true,
                                        "description" : "Consent Date",
                                        "searchable" : true,
                                        "title" : "Consent Date",
                                        "userEditable" : true,
                                        "type" : "string"
                                    },
                                    "mapping" : {
                                        "viewable" : true,
                                        "description" : "Mapping",
                                        "searchable" : true,
                                        "title" : "Mapping",
                                        "userEditable" : true,
                                        "type" : "string"
                                    }
                                },
                                "title" : "Consented Mapping"
                            },
                            "type" : "array"
                        },
                        "telephoneNumber" : {
                            "viewable" : true,
                            "description" : "Telephone Number",
                            "title" : "Telephone Number",
                            "pattern" : "^\\+?([0-9\\- \\(\\)])*$",
                            "isPersonal" : true,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "usageDescription" : "",
                            "type" : "string"
                        },
                        "givenName" : {
                            "viewable" : true,
                            "description" : "First Name",
                            "searchable" : true,
                            "title" : "First Name",
                            "usageDescription" : "",
                            "isPersonal" : true,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "roles" : {
                            "viewable" : true,
                            "relationshipGrantTemporalConstraintsEnforced" : true,
                            "description" : "Provisioning Roles",
                            "title" : "Provisioning Roles",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "items" : {
                                "title" : "Provisioning Roles Items",
                                "reversePropertyName" : "members",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string",
                                        "description" : "References a relationship from a managed object"
                                    },
                                    "_refProperties" : {
                                        "properties" : {
                                            "_id" : {
                                                "type" : "string",
                                                "description" : "_refProperties object ID"
                                            },
                                            "_grantType" : {
                                                "type" : "string",
                                                "description" : "Grant Type",
                                                "label" : "Grant Type"
                                            }
                                        },
                                        "type" : "object",
                                        "description" : "Supports metadata within the relationship",
                                        "title" : "Provisioning Roles Items _refProperties"
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "conditionalAssociationField" : "condition",
                                        "path" : "managed/role",
                                        "query" : {
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "label" : "Role"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : true,
                                "type" : "relationship",
                                "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:User:roles:items",
                                "reverseRelationship" : true
                            },
                            "type" : "array",
                            "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:User:roles"
                        },
                        "country" : {
                            "viewable" : true,
                            "description" : "Country",
                            "title" : "Country",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "adminOfOrg" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : "Organizations I Administer",
                            "items" : {
                                "reversePropertyName" : "admins",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/organization",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "notify" : true,
                                        "label" : "Organization"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : false,
                                "type" : "relationship",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "policies" : [ ],
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "authzRoles" : {
                            "viewable" : true,
                            "description" : "Authorization Roles",
                            "title" : "Authorization Roles",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "items" : {
                                "title" : "Authorization Roles Items",
                                "reversePropertyName" : "authzMembers",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string",
                                        "description" : "References a relationship from a managed object"
                                    },
                                    "_refProperties" : {
                                        "properties" : {
                                            "_id" : {
                                                "type" : "string",
                                                "description" : "_refProperties object ID"
                                            }
                                        },
                                        "type" : "object",
                                        "description" : "Supports metadata within the relationship",
                                        "title" : "Authorization Roles Items _refProperties"
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "conditionalAssociationField" : "condition",
                                        "path" : "internal/role",
                                        "query" : {
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "label" : "Internal Role"
                                    }
                                ],
                                "validate" : true,
                                "type" : "relationship",
                                "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:User:authzRoles:items",
                                "reverseRelationship" : true
                            },
                            "type" : "array",
                            "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:User:authzRoles"
                        },
                        "accountStatus" : {
                            "viewable" : true,
                            "description" : "Status",
                            "searchable" : true,
                            "title" : "Status",
                            "default" : "active",
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : false,
                            "policies" : [
                                {
                                    "params" : {
                                        "regexp" : "^(active|inactive)$"
                                    },
                                    "policyId" : "regexpMatches"
                                }
                            ],
                            "type" : "string"
                        },
                        "sn" : {
                            "viewable" : true,
                            "description" : "Last Name",
                            "searchable" : true,
                            "title" : "Last Name",
                            "usageDescription" : "",
                            "isPersonal" : true,
                            "userEditable" : true,
                            "policies" : [
                                {
                                    "params" : {
                                        "minLength" : 1
                                    },
                                    "policyId" : "minimum-length"
                                },
                                {
                                    "params" : {
                                        "maxLength" : 255
                                    },
                                    "policyId" : "maximum-length"
                                }
                            ],
                            "type" : "string"
                        },
                        "_id" : {
                            "viewable" : false,
                            "description" : "User ID",
                            "searchable" : false,
                            "usageDescription" : "",
                            "isPersonal" : false,
                            "userEditable" : false,
                            "policies" : [
                                {
                                    "params" : {
                                        "forbiddenChars" : [
                                            "/"
                                        ]
                                    },
                                    "policyId" : "cannot-contain-characters"
                                }
                            ],
                            "type" : "string"
                        },
                        "memberOfOrgIDs" : {
                            "viewable" : false,
                            "searchable" : false,
                            "title" : "MemberOfOrgIDs",
                            "isVirtual" : true,
                            "items" : {
                                "type" : "string",
                                "title" : "org identifiers"
                            },
                            "queryConfig" : {
                                "flattenProperties" : true,
                                "referencedObjectFields" : [
                                    "_id",
                                    "parentIDs"
                                ],
                                "referencedRelationshipFields" : [
                                    "memberOfOrg"
                                ]
                            },
                            "userEditable" : false,
                            "returnByDefault" : true,
                            "type" : "array"
                        },
                        "idps" : {
                            "title" : "Identity Providers",
                            "viewable" : true,
                            "searchable" : false,
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "type" : "array",
                            "items" : {
                                "type" : "relationship",
                                "reverseRelationship" : true,
                                "reversePropertyName" : "user",
                                "notifySelf" : true,
                                "validate" : true,
                                "properties" : {
                                    "_ref" : {
                                        "description" : "References a relationship from a managed object",
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "description" : "Supports metadata within the relationship",
                                        "type" : "object",
                                        "title" : "Identity Providers _refProperties",
                                        "properties" : { }
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/microsoft",
                                        "label" : "microsoft Info",
                                        "query" : {
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "id",
                                                "displayName",
                                                "userPrincipalName"
                                            ],
                                            "sortKeys" : [
                                                "id",
                                                "displayName",
                                                "userPrincipalName"
                                            ]
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "viewable" : true,
                    "title" : "User",
                    "required" : [
                        "userName",
                        "givenName",
                        "sn",
                        "mail"
                    ],
                    "order" : [
                        "_id",
                        "userName",
                        "password",
                        "givenName",
                        "sn",
                        "mail",
                        "description",
                        "accountStatus",
                        "telephoneNumber",
                        "postalAddress",
                        "city",
                        "postalCode",
                        "country",
                        "stateProvince",
                        "roles",
                        "manager",
                        "authzRoles",
                        "reports",
                        "effectiveRoles",
                        "effectiveAssignments",
                        "lastSync",
                        "kbaInfo",
                        "preferences",
                        "consentedMappings",
                        "ownerOfOrg",
                        "adminOfOrg",
                        "memberOfOrg",
                        "memberOfOrgIDs",
                        "managedApplications",
                        "serviceAccounts",
                        "accounts",
                        "idps"
                    ],
                    "mat-icon" : "people",
                    "$schema" : "http://json-schema.org/draft-03/schema",
                    "type" : "object",
                    "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:User",
                    "icon" : "fa-user"
                },
                "actions" : {
                    "unbind" : {
                        "type" : "text/javascript",
                        "file" : "ui/unBindBehavior.js",
                        "apiDescriptor" : {
                            "parameters" : [
                                {
                                    "name" : "provider",
                                    "type" : "string",
                                    "required" : true
                                }
                            ]
                        }
                    },
                    "bind" : {
                        "type" : "text/javascript",
                        "file" : "ui/bindBehavior.js",
                        "apiDescriptor" : {
                            "parameters" : [
                                {
                                    "name" : "provider",
                                    "type" : "string",
                                    "required" : true
                                }
                            ]
                        }
                    }
                }
            },
            {
                "onDelete" : {
                    "type" : "text/javascript",
                    "file" : "roles/onDelete-roles.js"
                },
                "name" : "role",
                "schema" : {
                    "description" : "",
                    "title" : "Role",
                    "required" : [
                        "name"
                    ],
                    "properties" : {
                        "name" : {
                            "viewable" : true,
                            "type" : "string",
                            "description" : "The role name, used for display purposes.",
                            "searchable" : true,
                            "title" : "Name"
                        },
                        "temporalConstraints" : {
                            "viewable" : false,
                            "description" : "An array of temporal constraints for a role",
                            "title" : "Temporal Constraints",
                            "items" : {
                                "order" : [
                                    "duration"
                                ],
                                "required" : [
                                    "duration"
                                ],
                                "type" : "object",
                                "properties" : {
                                    "duration" : {
                                        "type" : "string",
                                        "description" : "Duration"
                                    }
                                },
                                "title" : "Temporal Constraints Items"
                            },
                            "notifyRelationships" : [
                                "members"
                            ],
                            "isTemporalConstraint" : true,
                            "returnByDefault" : true,
                            "type" : "array"
                        },
                        "assignments" : {
                            "viewable" : true,
                            "description" : "Managed Assignments",
                            "title" : "Managed Assignments",
                            "items" : {
                                "title" : "Managed Assignments Items",
                                "reversePropertyName" : "roles",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string",
                                        "description" : "References a relationship from a managed object"
                                    },
                                    "_refProperties" : {
                                        "properties" : {
                                            "_id" : {
                                                "type" : "string",
                                                "description" : "_refProperties object ID"
                                            }
                                        },
                                        "type" : "object",
                                        "description" : "Supports metadata within the relationship",
                                        "title" : "Managed Assignments Items _refProperties"
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/assignment",
                                        "query" : {
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "label" : "Assignment"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : true,
                                "type" : "relationship",
                                "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:Role:assignments:items",
                                "reverseRelationship" : true
                            },
                            "notifyRelationships" : [
                                "members"
                            ],
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "members" : {
                            "viewable" : true,
                            "relationshipGrantTemporalConstraintsEnforced" : true,
                            "description" : "Role Members",
                            "title" : "Role Members",
                            "items" : {
                                "title" : "Role Members Items",
                                "reversePropertyName" : "roles",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string",
                                        "description" : "References a relationship from a managed object"
                                    },
                                    "_refProperties" : {
                                        "properties" : {
                                            "_id" : {
                                                "type" : "string",
                                                "description" : "_refProperties object ID"
                                            },
                                            "_grantType" : {
                                                "type" : "string",
                                                "description" : "Grant Type",
                                                "label" : "Grant Type"
                                            }
                                        },
                                        "type" : "object",
                                        "description" : "Supports metadata within the relationship",
                                        "title" : "Role Members Items _refProperties"
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/user",
                                        "conditionalAssociation" : true,
                                        "query" : {
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "userName",
                                                "givenName",
                                                "sn"
                                            ]
                                        },
                                        "notify" : true,
                                        "label" : "User"
                                    }
                                ],
                                "validate" : true,
                                "type" : "relationship",
                                "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:Role:members:items",
                                "reverseRelationship" : true
                            },
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "_id" : {
                            "viewable" : false,
                            "type" : "string",
                            "description" : "Role ID",
                            "searchable" : false,
                            "title" : "Name"
                        },
                        "condition" : {
                            "viewable" : false,
                            "isConditional" : true,
                            "searchable" : false,
                            "title" : "Condition",
                            "type" : "string",
                            "description" : "A conditional filter for this role"
                        },
                        "description" : {
                            "viewable" : true,
                            "type" : "string",
                            "description" : "The role description, used for display purposes.",
                            "searchable" : true,
                            "title" : "Description"
                        }
                    },
                    "mat-icon" : "assignment_ind",
                    "$schema" : "http://forgerock.org/json-schema#",
                    "order" : [
                        "_id",
                        "name",
                        "description",
                        "members",
                        "assignments",
                        "condition",
                        "temporalConstraints"
                    ],
                    "type" : "object",
                    "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:Role",
                    "icon" : "fa-check-square"
                }
            },
            {
                "name" : "assignment",
                "schema" : {
                    "description" : "A role assignment",
                    "title" : "Assignment",
                    "required" : [
                        "name",
                        "description",
                        "mapping"
                    ],
                    "properties" : {
                        "name" : {
                            "viewable" : true,
                            "type" : "string",
                            "description" : "The assignment name, used for display purposes.",
                            "searchable" : true,
                            "title" : "Name"
                        },
                        "roles" : {
                            "viewable" : true,
                            "description" : "Managed Roles",
                            "title" : "Managed Roles",
                            "items" : {
                                "title" : "Managed Roles Items",
                                "reversePropertyName" : "assignments",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string",
                                        "description" : "References a relationship from a managed object"
                                    },
                                    "_refProperties" : {
                                        "properties" : {
                                            "_id" : {
                                                "type" : "string",
                                                "description" : "_refProperties object ID"
                                            }
                                        },
                                        "type" : "object",
                                        "description" : "Supports metadata within the relationship",
                                        "title" : "Managed Roles Items _refProperties"
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/role",
                                        "query" : {
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "notify" : true,
                                        "label" : "Role"
                                    }
                                ],
                                "validate" : true,
                                "type" : "relationship",
                                "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:Assignment:roles:items",
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "linkQualifiers" : {
                            "items" : {
                                "type" : "string",
                                "title" : "Link Qualifiers Items"
                            },
                            "viewable" : true,
                            "type" : "array",
                            "description" : "Conditional link qualifiers to restrict this assignment to.",
                            "title" : "Link Qualifiers"
                        },
                        "mapping" : {
                            "viewable" : true,
                            "description" : "The name of the mapping this assignment applies to",
                            "searchable" : true,
                            "title" : "Mapping",
                            "policies" : [
                                {
                                    "policyId" : "mapping-exists"
                                }
                            ],
                            "type" : "string"
                        },
                        "attributes" : {
                            "viewable" : true,
                            "description" : "The attributes operated on by this assignment.",
                            "notifyRelationships" : [
                                "roles"
                            ],
                            "items" : {
                                "required" : [ ],
                                "order" : [
                                    "assignmentOperation",
                                    "unassignmentOperation",
                                    "name",
                                    "value"
                                ],
                                "type" : "object",
                                "properties" : {
                                    "unassignmentOperation" : {
                                        "type" : "string",
                                        "description" : "Unassignment operation"
                                    },
                                    "assignmentOperation" : {
                                        "type" : "string",
                                        "description" : "Assignment operation"
                                    },
                                    "value" : {
                                        "type" : "string",
                                        "description" : "Value"
                                    },
                                    "name" : {
                                        "type" : "string",
                                        "description" : "Name"
                                    }
                                },
                                "title" : "Assignment Attributes Items"
                            },
                            "title" : "Assignment Attributes",
                            "type" : "array"
                        },
                        "_id" : {
                            "viewable" : false,
                            "type" : "string",
                            "description" : "The assignment ID",
                            "searchable" : false,
                            "title" : "Name"
                        },
                        "description" : {
                            "viewable" : true,
                            "type" : "string",
                            "description" : "The assignment description, used for display purposes.",
                            "searchable" : true,
                            "title" : "Description"
                        }
                    },
                    "mat-icon" : "vpn_key",
                    "$schema" : "http://forgerock.org/json-schema#",
                    "order" : [
                        "_id",
                        "name",
                        "description",
                        "mapping",
                        "attributes",
                        "linkQualifiers",
                        "roles"
                    ],
                    "type" : "object",
                    "id" : "urn:jsonschema:org:forgerock:openidm:managed:api:Assignment",
                    "icon" : "fa-key"
                }
            },
            {
                "name" : "organization",
                "schema" : {
                    "description" : "An organization or tenant, whose resources are managed by organizational admins.",
                    "title" : "Organization",
                    "required" : [
                        "name"
                    ],
                    "order" : [
                        "name",
                        "description",
                        "owners",
                        "admins",
                        "members",
                        "parent",
                        "children",
                        "adminIDs",
                        "ownerIDs",
                        "parentAdminIDs",
                        "parentOwnerIDs",
                        "parentIDs"
                    ],
                    "mat-icon" : "domain",
                    "$schema" : "http://forgerock.org/json-schema#",
                    "type" : "object",
                    "properties" : {
                        "ownerIDs" : {
                            "viewable" : false,
                            "searchable" : false,
                            "title" : "Owner user ids",
                            "isVirtual" : true,
                            "items" : {
                                "type" : "string",
                                "title" : "owner ids"
                            },
                            "queryConfig" : {
                                "flattenProperties" : true,
                                "referencedObjectFields" : [
                                    "_id"
                                ],
                                "referencedRelationshipFields" : [
                                    "owners"
                                ]
                            },
                            "userEditable" : false,
                            "returnByDefault" : true,
                            "type" : "array"
                        },
                        "owners" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : "Owner",
                            "items" : {
                                "reversePropertyName" : "ownerOfOrg",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/user",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "userName",
                                                "givenName",
                                                "sn"
                                            ]
                                        },
                                        "notify" : false,
                                        "label" : "User"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : true,
                                "type" : "relationship",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "reverseRelationship" : true
                            },
                            "notifyRelationships" : [
                                "children"
                            ],
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "name" : {
                            "viewable" : true,
                            "type" : "string",
                            "userEditable" : true,
                            "searchable" : true,
                            "title" : "Name"
                        },
                        "parent" : {
                            "viewable" : true,
                            "description" : "Parent Organization",
                            "searchable" : false,
                            "title" : "Parent Organization",
                            "notifyRelationships" : [
                                "children",
                                "members"
                            ],
                            "reversePropertyName" : "children",
                            "resourceCollection" : [
                                {
                                    "path" : "managed/organization",
                                    "query" : {
                                        "sortKeys" : [ ],
                                        "queryFilter" : "true",
                                        "fields" : [
                                            "name",
                                            "description"
                                        ]
                                    },
                                    "notify" : true,
                                    "label" : "Organization"
                                }
                            ],
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "validate" : true,
                            "notifySelf" : true,
                            "type" : "relationship",
                            "properties" : {
                                "_ref" : {
                                    "type" : "string"
                                },
                                "_refProperties" : {
                                    "type" : "object",
                                    "properties" : {
                                        "_id" : {
                                            "required" : false,
                                            "type" : "string",
                                            "propName" : "_id"
                                        }
                                    }
                                }
                            },
                            "reverseRelationship" : true
                        },
                        "parentOwnerIDs" : {
                            "viewable" : false,
                            "searchable" : false,
                            "title" : "user ids of parent owners",
                            "isVirtual" : true,
                            "items" : {
                                "type" : "string",
                                "title" : "user ids of parent owners"
                            },
                            "queryConfig" : {
                                "flattenProperties" : true,
                                "referencedObjectFields" : [
                                    "ownerIDs",
                                    "parentOwnerIDs"
                                ],
                                "referencedRelationshipFields" : [
                                    "parent"
                                ]
                            },
                            "userEditable" : false,
                            "returnByDefault" : true,
                            "type" : "array"
                        },
                        "parentIDs" : {
                            "viewable" : false,
                            "searchable" : false,
                            "title" : "parent org ids",
                            "isVirtual" : true,
                            "items" : {
                                "type" : "string",
                                "title" : "parent org ids"
                            },
                            "queryConfig" : {
                                "flattenProperties" : true,
                                "referencedObjectFields" : [
                                    "_id",
                                    "parentIDs"
                                ],
                                "referencedRelationshipFields" : [
                                    "parent"
                                ]
                            },
                            "userEditable" : false,
                            "returnByDefault" : true,
                            "type" : "array"
                        },
                        "adminIDs" : {
                            "viewable" : false,
                            "searchable" : false,
                            "title" : "Admin user ids",
                            "isVirtual" : true,
                            "items" : {
                                "type" : "string",
                                "title" : "admin ids"
                            },
                            "queryConfig" : {
                                "flattenProperties" : true,
                                "referencedObjectFields" : [
                                    "_id"
                                ],
                                "referencedRelationshipFields" : [
                                    "admins"
                                ]
                            },
                            "userEditable" : false,
                            "returnByDefault" : true,
                            "type" : "array"
                        },
                        "admins" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : "Administrators",
                            "items" : {
                                "reversePropertyName" : "adminOfOrg",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/user",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "userName",
                                                "givenName",
                                                "sn"
                                            ]
                                        },
                                        "notify" : false,
                                        "label" : "User"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : true,
                                "type" : "relationship",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "reverseRelationship" : true
                            },
                            "notifyRelationships" : [
                                "children"
                            ],
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "members" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : "Members",
                            "items" : {
                                "reversePropertyName" : "memberOfOrg",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/user",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "userName",
                                                "givenName",
                                                "sn"
                                            ]
                                        },
                                        "notify" : true,
                                        "label" : "User"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : false,
                                "type" : "relationship",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "parentAdminIDs" : {
                            "viewable" : false,
                            "searchable" : false,
                            "title" : "user ids of parent admins",
                            "isVirtual" : true,
                            "items" : {
                                "type" : "string",
                                "title" : "user ids of parent admins"
                            },
                            "queryConfig" : {
                                "flattenProperties" : true,
                                "referencedObjectFields" : [
                                    "adminIDs",
                                    "parentAdminIDs"
                                ],
                                "referencedRelationshipFields" : [
                                    "parent"
                                ]
                            },
                            "userEditable" : false,
                            "returnByDefault" : true,
                            "type" : "array"
                        },
                        "children" : {
                            "viewable" : false,
                            "description" : "Child Organizations",
                            "searchable" : false,
                            "title" : "Child Organizations",
                            "items" : {
                                "reversePropertyName" : "parent",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/organization",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name",
                                                "description"
                                            ]
                                        },
                                        "notify" : true,
                                        "label" : "Organization"
                                    }
                                ],
                                "validate" : true,
                                "notifySelf" : true,
                                "type" : "relationship",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "policies" : [ ],
                            "returnByDefault" : false,
                            "type" : "array"
                        },
                        "description" : {
                            "viewable" : true,
                            "type" : "string",
                            "userEditable" : true,
                            "searchable" : true,
                            "title" : "Description"
                        }
                    },
                    "icon" : "fa-building"
                }
            },
            {
                "name" : "application",
                "schema" : {
                    "description" : null,
                    "title" : "Application",
                    "required" : [
                        "name",
                        "owner"
                    ],
                    "order" : [
                        "name",
                        "description",
                        "owner",
                        "ownerId",
                        "igaContent"
                    ],
                    "$schema" : "http://forgerock.org/json-schema#",
                    "type" : "object",
                    "properties" : {
                        "owner" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : null,
                            "reversePropertyName" : "managedApplications",
                            "resourceCollection" : [
                                {
                                    "path" : "managed/user",
                                    "query" : {
                                        "sortKeys" : [ ],
                                        "queryFilter" : "true",
                                        "fields" : [
                                            "userName"
                                        ]
                                    },
                                    "notify" : true,
                                    "label" : "User"
                                }
                            ],
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "validate" : false,
                            "notifySelf" : false,
                            "type" : "relationship",
                            "properties" : {
                                "_ref" : {
                                    "type" : "string"
                                },
                                "_refProperties" : {
                                    "type" : "object",
                                    "properties" : {
                                        "_id" : {
                                            "required" : false,
                                            "type" : "string",
                                            "propName" : "_id"
                                        }
                                    }
                                }
                            },
                            "reverseRelationship" : true
                        },
                        "ownerId" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : true,
                            "title" : null,
                            "isVirtual" : true,
                            "queryConfig" : {
                                "referencedObjectFields" : [
                                    "_id"
                                ],
                                "referencedRelationshipFields" : [
                                    "owner"
                                ]
                            },
                            "deleteQueryConfig" : false,
                            "userEditable" : true,
                            "returnByDefault" : true,
                            "type" : "string"
                        },
                        "igaContent" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : null,
                            "order" : [ ],
                            "userEditable" : true,
                            "type" : "object",
                            "properties" : { }
                        },
                        "name" : {
                            "viewable" : true,
                            "type" : "string",
                            "userEditable" : true,
                            "searchable" : true,
                            "title" : null
                        },
                        "description" : {
                            "viewable" : true,
                            "type" : "string",
                            "userEditable" : true,
                            "searchable" : true,
                            "title" : null
                        }
                    },
                    "icon" : "fa-database"
                }
            },
            {
                "name" : "account",
                "schema" : {
                    "description" : "User account",
                    "title" : "Account",
                    "required" : [ ],
                    "order" : [
                        "application",
                        "user",
                        "accountType",
                        "resources",
                        "igaContent",
                        "applicationId",
                        "userId",
                        "active",
                        "actors"
                    ],
                    "$schema" : "http://forgerock.org/json-schema#",
                    "type" : "object",
                    "properties" : {
                        "igaContent" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : null,
                            "order" : [ ],
                            "userEditable" : true,
                            "type" : "object",
                            "properties" : { }
                        },
                        "userId" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : null,
                            "isVirtual" : true,
                            "required" : [ ],
                            "queryConfig" : {
                                "referencedObjectFields" : [
                                    "_id",
                                    "sn",
                                    "givenName",
                                    "userName",
                                    "mail"
                                ],
                                "referencedRelationshipFields" : [
                                    "user"
                                ]
                            },
                            "order" : [ ],
                            "deleteQueryConfig" : false,
                            "userEditable" : true,
                            "returnByDefault" : true,
                            "type" : "object",
                            "properties" : { }
                        },
                        "application" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : "Application",
                            "reversePropertyName" : "accounts",
                            "resourceCollection" : [
                                {
                                    "path" : "managed/application",
                                    "query" : {
                                        "sortKeys" : [ ],
                                        "queryFilter" : "true",
                                        "fields" : [
                                            "name"
                                        ]
                                    },
                                    "notify" : false,
                                    "label" : "Application"
                                }
                            ],
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "validate" : true,
                            "notifySelf" : false,
                            "type" : "relationship",
                            "properties" : {
                                "_ref" : {
                                    "type" : "string"
                                },
                                "_refProperties" : {
                                    "type" : "object",
                                    "properties" : {
                                        "_id" : {
                                            "required" : false,
                                            "type" : "string",
                                            "propName" : "_id"
                                        }
                                    }
                                }
                            },
                            "reverseRelationship" : true
                        },
                        "actors" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : "Actors",
                            "isVirtual" : false,
                            "items" : {
                                "reversePropertyName" : "serviceAccounts",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/user",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "userName"
                                            ]
                                        },
                                        "notify" : false,
                                        "label" : "User"
                                    }
                                ],
                                "notifySelf" : false,
                                "type" : "relationship",
                                "validate" : false,
                                "reverseRelationship" : true
                            },
                            "referencedRelationshipFields" : null,
                            "deleteQueryConfig" : false,
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "requiredByParent" : false,
                            "referencedObjectFields" : null,
                            "type" : "array"
                        },
                        "user" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : "User",
                            "reversePropertyName" : "accounts",
                            "resourceCollection" : [
                                {
                                    "path" : "managed/user",
                                    "query" : {
                                        "sortKeys" : [ ],
                                        "queryFilter" : "true",
                                        "fields" : [
                                            "userName"
                                        ]
                                    },
                                    "notify" : false,
                                    "label" : "User"
                                }
                            ],
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "validate" : true,
                            "notifySelf" : false,
                            "type" : "relationship",
                            "properties" : {
                                "_ref" : {
                                    "type" : "string"
                                },
                                "_refProperties" : {
                                    "type" : "object",
                                    "properties" : {
                                        "overrideRecon" : {
                                            "required" : false,
                                            "type" : "boolean",
                                            "propName" : "overrideRecon",
                                            "label" : "Recon Override"
                                        },
                                        "assignmentDate" : {
                                            "required" : false,
                                            "type" : "string",
                                            "propName" : "assignmentDate",
                                            "label" : "Assignment Date"
                                        },
                                        "_id" : {
                                            "required" : false,
                                            "type" : "string",
                                            "propName" : "_id"
                                        }
                                    }
                                }
                            },
                            "reverseRelationship" : true
                        },
                        "accountType" : {
                            "viewable" : true,
                            "type" : "string",
                            "userEditable" : true,
                            "searchable" : true,
                            "title" : "Account Type"
                        },
                        "active" : {
                            "viewable" : true,
                            "type" : "boolean",
                            "userEditable" : true,
                            "searchable" : false,
                            "title" : "Active"
                        },
                        "applicationId" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : true,
                            "title" : null,
                            "isVirtual" : true,
                            "queryConfig" : {
                                "referencedObjectFields" : [
                                    "_id",
                                    "name"
                                ],
                                "referencedRelationshipFields" : [
                                    "application"
                                ]
                            },
                            "deleteQueryConfig" : false,
                            "userEditable" : false,
                            "returnByDefault" : true,
                            "type" : "object"
                        },
                        "resources" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : "Resources",
                            "items" : {
                                "reversePropertyName" : "accounts",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/resource",
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "name"
                                            ]
                                        },
                                        "notify" : false,
                                        "label" : "Resource"
                                    }
                                ],
                                "notifySelf" : false,
                                "type" : "relationship",
                                "validate" : true,
                                "reverseRelationship" : true
                            },
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "type" : "array"
                        }
                    },
                    "icon" : "fa-users"
                }
            },
            {
                "name" : "resource",
                "schema" : {
                    "description" : "Generic resources",
                    "title" : "Resource",
                    "required" : [
                        "name",
                        "application",
                        "resourceType"
                    ],
                    "order" : [
                        "name",
                        "application",
                        "accounts",
                        "resourceType",
                        "igaContent",
                        "applicationId"
                    ],
                    "$schema" : "http://forgerock.org/json-schema#",
                    "type" : "object",
                    "properties" : {
                        "igaContent" : {
                            "viewable" : true,
                            "searchable" : false,
                            "title" : "IGA Content",
                            "order" : [ ],
                            "userEditable" : true,
                            "type" : "object",
                            "properties" : { }
                        },
                        "name" : {
                            "viewable" : true,
                            "type" : "string",
                            "userEditable" : true,
                            "searchable" : true,
                            "title" : "Name"
                        },
                        "resourceType" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : true,
                            "title" : "Resource Type",
                            "isVirtual" : false,
                            "deleteQueryConfig" : false,
                            "userEditable" : true,
                            "type" : "string"
                        },
                        "application" : {
                            "viewable" : true,
                            "description" : "Application that the resource belongs to",
                            "searchable" : false,
                            "title" : "Application",
                            "reversePropertyName" : "resources",
                            "properties" : {
                                "_ref" : {
                                    "type" : "string"
                                },
                                "_refProperties" : {
                                    "type" : "object",
                                    "properties" : {
                                        "_id" : {
                                            "required" : false,
                                            "type" : "string",
                                            "propName" : "_id"
                                        }
                                    }
                                }
                            },
                            "userEditable" : false,
                            "returnByDefault" : false,
                            "resourceCollection" : [
                                {
                                    "path" : "managed/application",
                                    "label" : "Application",
                                    "notify" : false,
                                    "query" : {
                                        "sortKeys" : [ ],
                                        "queryFilter" : "true",
                                        "fields" : [
                                            "name"
                                        ]
                                    }
                                }
                            ],
                            "notifySelf" : false,
                            "type" : "relationship",
                            "validate" : true,
                            "reverseRelationship" : true
                        },
                        "accounts" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : "Accounts",
                            "items" : {
                                "reversePropertyName" : "resources",
                                "properties" : {
                                    "_ref" : {
                                        "type" : "string"
                                    },
                                    "_refProperties" : {
                                        "type" : "object",
                                        "properties" : {
                                            "_id" : {
                                                "required" : false,
                                                "type" : "string",
                                                "propName" : "_id"
                                            }
                                        }
                                    }
                                },
                                "validate" : true,
                                "type" : "relationship",
                                "resourceCollection" : [
                                    {
                                        "path" : "managed/account",
                                        "label" : "Account",
                                        "notify" : false,
                                        "query" : {
                                            "sortKeys" : [ ],
                                            "queryFilter" : "true",
                                            "fields" : [
                                                "user"
                                            ]
                                        }
                                    }
                                ],
                                "reverseRelationship" : true
                            },
                            "returnByDefault" : false,
                            "userEditable" : false,
                            "policies" : [ ],
                            "minLength" : null,
                            "pattern" : null,
                            "notifySelf" : false,
                            "type" : "array"
                        },
                        "applicationId" : {
                            "viewable" : true,
                            "description" : null,
                            "searchable" : false,
                            "title" : null,
                            "isVirtual" : true,
                            "required" : [ ],
                            "queryConfig" : {
                                "referencedObjectFields" : [
                                    "_id",
                                    "name",
                                    "igaContent/logo"
                                ],
                                "referencedRelationshipFields" : [
                                    "application"
                                ]
                            },
                            "order" : [ ],
                            "deleteQueryConfig" : false,
                            "userEditable" : true,
                            "returnByDefault" : true,
                            "type" : "object",
                            "properties" : { }
                        }
                    },
                    "icon" : "fa-archive"
                }
            },
            {
                "name" : "microsoft",
                "title" : "microsoft User Info",
                "schema" : {
                    "title" : "Microsoft",
                    "type" : "object",
                    "viewable" : true,
                    "properties" : {
                        "user" : {
                            "viewable" : true,
                            "searchable" : false,
                            "type" : "relationship",
                            "title" : "User",
                            "reverseRelationship" : true,
                            "reversePropertyName" : "idps",
                            "validate" : true,
                            "properties" : {
                                "_ref" : {
                                    "description" : "References a relationship from a managed object",
                                    "type" : "string"
                                },
                                "_refProperties" : {
                                    "description" : "Supports metadata within the relationship",
                                    "type" : "object",
                                    "title" : "microsoftuser _refProperties",
                                    "properties" : { }
                                }
                            },
                            "resourceCollection" : [
                                {
                                    "path" : "managed/user",
                                    "notify" : true,
                                    "label" : "User",
                                    "query" : {
                                        "queryFilter" : "true",
                                        "fields" : [
                                            "userName"
                                        ],
                                        "sortKeys" : [
                                            "userName"
                                        ]
                                    }
                                }
                            ]
                        },
                        "id" : {
                            "description" : "ID",
                            "title" : "ID",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : false
                        },
                        "displayName" : {
                            "description" : "Name",
                            "title" : "Name",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : true
                        },
                        "givenName" : {
                            "description" : "First Name",
                            "title" : "First Name",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : true
                        },
                        "surname" : {
                            "description" : "Last Name",
                            "title" : "Last Name",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : true
                        },
                        "userPrincipalName" : {
                            "description" : "Email Address",
                            "title" : "Email Address",
                            "viewable" : true,
                            "type" : "string",
                            "searchable" : true
                        }
                    },
                    "order" : [
                        "id",
                        "displayName",
                        "userPrincipalName",
                        "givenName",
                        "surname",
                        "user"
                    ],
                    "id" : "urn:jsonschema:org:forgerock:openidm:identityProviders:api:Microsoft",
                    "$schema" : "http://json-schema.org/draft-03/schema",
                    "required" : [ ]
                }
            }
        ]
        }

---
apiVersion: v1
kind: ConfigMap
metadata:
    name: openidm-populateasmanageduserfromrelationship-js
data:
    populateAsManagedUserFromRelationship.js: |
        /*
        * Copyright 2016-2018 ForgeRock AS. All Rights Reserved
        *
        * Use of this code requires a commercial software license with ForgeRock AS.
        * or with one of its affiliates. All use shall be exclusively subject
        * to such license between the licensee and ForgeRock AS.
        */

        /*global security, properties, openidm */

        /**
        * This security context population script is called when the auth module authenticates a
        * user from a security context which is related to managed/idpData, and we wish to aggregate
        * the current security context with the one for the linked managed/user record (if found).
        *
        * global properties - auth module-specific properties from authentication.json for the
        *                     a potential OAUTH or OPENID_CONNECT auth module
        *      {
        *          "name" : "",
        *          "properties" : {
        *              "augmentSecurityContext": {
        *                  "type" : "text/javascript",
        *                  "file" : "auth/populateAsManagedUserFromRelationship.js"
        *              },
        *              "queryOnResource" : "managed/google",
        *              "propertyMapping" : {
        *                  "userRoles" : "authzRoles",
        *                  "authenticationId" : "_id"
        *              }
        *          },
        *          "defaultUserRoles" : [
        *              "internal/role/openidm-authorized"
        *          ],
        *          "resolvers" : [
        *          ...
        *          ],
        *          "authTokenHeader" : "authToken",
        *          "authResolverHeader" : "provider"
        *          ...
        *      }
        *
        * global security - map of security context details as have been determined thus far
        *
        *      {
        *          "authorization": {
        *              "id": "jsmith",
        *              "component": "managed/google",
        *              "roles": [ "internal/role/openidm-authorized" ]
        *          },
        *          "authenticationId": "1234567",
        *      }
        */

        (function () {
            logger.debug("Augment context for: {}", security.authenticationId);

            var _ = require("lib/lodash"),
                provider = requestContextMap.provider,
                baseObject = openidm.read("managed/" + provider + "/" + security.authorization.id, null, ["*","user"]);

            if (!baseObject || !baseObject.user) {
                throw {
                    "code" : 401,
                    "message" : "Access denied"
                };
            }

            var managedUser = openidm.read(baseObject.user._ref, null, ["*", "authzRoles/*"]);

            if (managedUser.accountStatus !== "active") {
                throw {
                    "code" : 401,
                    "message" : "Access denied, user inactive"
                };
            }

            // copy and update necessary fields within security authorization map
            var securityContextClone = {};
            Object.keys(security.authorization).forEach(function (k) {
                securityContextClone[k] = security.authorization[k];
            });

            securityContextClone.id = managedUser._id;
            securityContextClone.component =  "managed/user";
            securityContextClone.queryId = "credential-query";
            securityContextClone.authenticationIdProperty = "username";
            securityContextClone.provider = provider;
            securityContextClone.roles = managedUser.authzRoles
                    ? _.uniq(
                        security.authorization.roles.concat(
                            _.map(managedUser.authzRoles, function (role) {
                                // appending empty string gets the value from java into a format more familiar to JS
                                return org.forgerock.json.resource.ResourcePath.valueOf(role._ref) + "";
                            })
                        )
                    )
                    : security.authorization.roles;
            securityContextClone.authenticationId = managedUser.userName;

            security.authorization = securityContextClone;

            return security;

        }());
